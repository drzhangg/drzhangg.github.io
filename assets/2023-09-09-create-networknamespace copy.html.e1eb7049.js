import{_ as p,r as l,o as c,c as o,a as n,b as s,w as e,d as t,e as r}from"./app.9117781d.js";const i={},u=n("hr",null,null,-1),k={class:"table-of-contents"},d=r(`<blockquote><p>\u719F\u6089\u4E00\u4E0B\u5728linux\u4E2D\uFF0C\u901A\u8FC7\u547D\u4EE4\u884C\u521B\u5EFAnetwork namespace\u865A\u62DF\u7F51\u7EDC\uFF0C\u8BBF\u95EE\u5230\u5916\u7F51</p></blockquote><h3 id="_1-\u521B\u5EFAnetwork-namespace" tabindex="-1"><a class="header-anchor" href="#_1-\u521B\u5EFAnetwork-namespace" aria-hidden="true">#</a> 1.\u521B\u5EFAnetwork namespace</h3><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token function">ip</span> netns <span class="token function">add</span> net1
</code></pre></div><h3 id="_2-\u521B\u5EFAveth\u5BF9" tabindex="-1"><a class="header-anchor" href="#_2-\u521B\u5EFAveth\u5BF9" aria-hidden="true">#</a> 2.\u521B\u5EFAveth\u5BF9</h3><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token comment"># \u521B\u5EFA veth0\u548Cveth1 \u4E00\u5BF9veth</span>
<span class="token function">ip</span> <span class="token function">link</span> <span class="token function">add</span> veth0 <span class="token builtin class-name">type</span> veth peer name veth1

</code></pre></div><h3 id="_3-\u914D\u7F6Enet1" tabindex="-1"><a class="header-anchor" href="#_3-\u914D\u7F6Enet1" aria-hidden="true">#</a> 3.\u914D\u7F6Enet1</h3><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token comment"># \u628A veth0\u63D2\u5165\u5230\u4E0A\u9762\u521B\u5EFA\u7684ns  net1\u4E2D</span>
<span class="token function">ip</span> <span class="token function">link</span> <span class="token builtin class-name">set</span> veth0 netns net1

<span class="token comment"># \u7ED9net1\u4E2D\u7684veth0\u914D\u7F6E\u4E0Aip</span>
<span class="token function">ip</span> netns <span class="token builtin class-name">exec</span> net1 <span class="token function">ip</span> addr <span class="token function">add</span> <span class="token number">192.168</span>.0.2/24 dev veth0

<span class="token comment"># \u542F\u52A8net1\u4E2D\u7684veth0</span>
<span class="token function">ip</span> netns <span class="token builtin class-name">exec</span> net1 <span class="token function">ip</span> <span class="token function">link</span> <span class="token builtin class-name">set</span> veth0 up
</code></pre></div><h3 id="_4-\u521B\u5EFAbridge" tabindex="-1"><a class="header-anchor" href="#_4-\u521B\u5EFAbridge" aria-hidden="true">#</a> 4.\u521B\u5EFAbridge</h3><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token function">ip</span> <span class="token function">link</span> <span class="token function">add</span> br0 <span class="token builtin class-name">type</span> bridge
</code></pre></div><h3 id="_5-\u914D\u7F6Ebridge" tabindex="-1"><a class="header-anchor" href="#_5-\u914D\u7F6Ebridge" aria-hidden="true">#</a> 5.\u914D\u7F6Ebridge</h3><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token comment"># \u7ED9br0\u914D\u7F6E\u4E0Aip</span>
<span class="token function">ip</span> addr <span class="token function">add</span> <span class="token number">192.168</span>.0.1/24 dev br0

<span class="token comment"># \u628Aveth1\u63A5\u5165\u5230bridge\u4E2D</span>
<span class="token function">ip</span> <span class="token function">link</span> <span class="token builtin class-name">set</span> dev veth1 master br0   <span class="token comment"># master \u662F\u4E00\u4E2A\u5173\u952E\u5B57\uFF0C\u7528\u4E8E\u5C06\u4E00\u4E2A\u7F51\u7EDC\u63A5\u53E3\u8BBE\u7F6E\u4E3A\u53E6\u4E00\u4E2A\u7F51\u7EDC\u8BBE\u5907\uFF08\u901A\u5E38\u662F\u7F51\u6865\uFF09\u7684\u4ECE\u5C5E\u6210\u5458</span>

<span class="token comment"># \u542F\u52A8 veth1</span>
<span class="token function">ip</span> <span class="token function">link</span> <span class="token builtin class-name">set</span> veth1 up

<span class="token comment"># \u542F\u52A8 br0</span>
<span class="token function">ip</span> <span class="token function">link</span> <span class="token builtin class-name">set</span> br0 up

</code></pre></div><h3 id="_6-\u5C1D\u8BD5\u8BF7\u6C42\u5916\u90E8\u8D44\u6E90" tabindex="-1"><a class="header-anchor" href="#_6-\u5C1D\u8BD5\u8BF7\u6C42\u5916\u90E8\u8D44\u6E90" aria-hidden="true">#</a> 6.\u5C1D\u8BD5\u8BF7\u6C42\u5916\u90E8\u8D44\u6E90</h3><div class="language-bash ext-sh"><pre class="language-bash"><code>$ <span class="token function">ip</span> netns <span class="token builtin class-name">exec</span> net1 <span class="token function">ping</span> <span class="token number">10.153</span>.*.*
connect: Network is unreachable  <span class="token comment">#\u7F51\u7EDC\u4E0D\u53EF\u8FBE</span>


<span class="token comment"># \u67E5\u770B\u4E0B\u8DEF\u7531</span>
<span class="token function">ip</span> netns <span class="token builtin class-name">exec</span> net1 route <span class="token parameter variable">-n</span>
Kernel IP routing table
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
<span class="token number">192.168</span>.0.0     <span class="token number">0.0</span>.0.0         <span class="token number">255.255</span>.255.0   U     <span class="token number">0</span>      <span class="token number">0</span>        <span class="token number">0</span> veth1

</code></pre></div><p>\u8FD9\u91CC\u56E0\u4E3Anet1\u4E2D\u8FD8\u6CA1\u6709\u914D\u7F6E\u8DEF\u7531\uFF0C\u9ED8\u8BA4\u53EA\u6709192.168.0.* \u8FD9\u4E2A\u7F51\u6BB5\u7684\u8DEF\u7531\u89C4\u5219\uFF0C\u6211\u4EECping\u7684ip\u662F 10.153.<em>.</em>\uFF0C\u6839\u636E\u8DEF\u7531\u8868\u627E\u4E0D\u5230\u51FA\u53E3\uFF0C\u6240\u4EE5\u5BFC\u81F4\u7684\u5931\u8D25\u3002</p><h3 id="_7-\u914D\u7F6E\u8DEF\u7531" tabindex="-1"><a class="header-anchor" href="#_7-\u914D\u7F6E\u8DEF\u7531" aria-hidden="true">#</a> 7.\u914D\u7F6E\u8DEF\u7531</h3><div class="language-bash ext-sh"><pre class="language-bash"><code>
<span class="token function">ip</span> netns <span class="token builtin class-name">exec</span> net1 route <span class="token function">add</span> default gw <span class="token number">192.168</span>.0.1 veth0
</code></pre></div><blockquote><p>\u8FD9\u91CC\u914D\u7F6E\u4E86\u4E00\u6761\u9ED8\u8BA4\u8DEF\u7531\uFF0C\u53EA\u8981\u5339\u914D\u4E0D\u5230\u5176\u4ED6\u89C4\u5219\uFF0C\u5C31\u9ED8\u8BA4\u8F6C\u53D1\u5230veth0\u4E0A\uFF0C\u540C\u65F6\u6307\u5B9A\u4E0B\u4E00\u6761\u662F\u5B83\u6240\u8FDE\u63A5\u7684Bridge\uFF08192.168.0.1\uFF09</p></blockquote><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token comment"># \u518Dping\u4E00\u4E0B</span>
<span class="token function">ip</span> netns <span class="token builtin class-name">exec</span> net1 <span class="token function">ping</span> <span class="token number">10.153</span>.*.* <span class="token parameter variable">-c</span> <span class="token number">2</span>
PING <span class="token number">10.153</span>.*.* <span class="token punctuation">(</span><span class="token number">10.153</span>.*.*<span class="token punctuation">)</span> <span class="token number">56</span><span class="token punctuation">(</span><span class="token number">84</span><span class="token punctuation">)</span> bytes of data.

--- <span class="token number">10.153</span>.*.* <span class="token function">ping</span> statistics ---
<span class="token number">2</span> packets transmitted, <span class="token number">0</span> received, <span class="token number">100</span>% packet loss, <span class="token function">time</span> 999ms

</code></pre></div><p>\u4ECD\u7136\u4E0D\u901A\uFF0C\u4E0A\u9762\u7684\u8DEF\u7531\u5E2E\u6211\u4EEC\u628A\u6570\u636E\u5305\u4ECE veth \u6B63\u786E\u9001\u5230\u4E86bridge\u7F51\u6865\u3002\u63A5\u4E0B\u6765\uFF0C\u7F51\u6865\u8FD8\u9700\u8981Bridge\u8F6C\u53D1\u5230eth0\u4E0A\u3002\u6240\u4EE5\u8FD8\u9700\u8981\u6253\u5F00\u4E24\u4E2A\u8F6C\u53D1\u76F8\u5173\u7684\u914D\u7F6E\u3002</p><h3 id="_8-\u914D\u7F6E\u8F6C\u53D1" tabindex="-1"><a class="header-anchor" href="#_8-\u914D\u7F6E\u8F6C\u53D1" aria-hidden="true">#</a> 8.\u914D\u7F6E\u8F6C\u53D1</h3><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token function">sysctl</span> <span class="token assign-left variable">net.ipv4.conf.all.forwarding</span><span class="token operator">=</span><span class="token number">1</span>

iptables <span class="token parameter variable">-P</span> FORWARD ACCEPT
</code></pre></div><p>\u4E0D\u8FC7\u8FD9\u4E2A\u65F6\u5019\uFF0C\u8FD8\u5B58\u5728\u4E00\u4E2A\u95EE\u9898\u3002\u90A3\u5C31\u662F\u5916\u90E8\u7684\u673A\u5668\u5E76\u4E0D\u8BA4\u8BC6192.168.0.* \u8FD9\u4E2A\u7F51\u6BB5\u7684ip\u3002\u4ED6\u4EEC\u90FD\u662F\u901A\u8FC7 10.* \u8FDB\u884C\u901A\u4FE1\u7684\u3002\u8FD9\u65F6\u5019\u9700\u8981\u4F7F\u7528SNAT\u8FDB\u884C\u914D\u7F6E\u3002</p><h3 id="_9-\u914D\u7F6Esnat" tabindex="-1"><a class="header-anchor" href="#_9-\u914D\u7F6Esnat" aria-hidden="true">#</a> 9.\u914D\u7F6ESNAT</h3><p>\u8FD9\u6B21\u7684\u9700\u6C42\u662F\u5B9E\u73B0\u5185\u90E8\u865B\u62DF\u7F51\u7EDC\u8BBF\u95EE\u5916\u7F51\uFF0C\u6240\u4EE5\u9700\u8981\u4F7F\u7528\u7684\u662FSNAT\u3002\u5B83\u5C06namespace\u8BF7\u6C42\u4E2D\u7684ip(192.168.0.2) \u6362\u6210\u5916\u90E8\u7F51\u7EDC\u8BA4\u8BC6\u768410.153.<em>.</em>\uFF0C\u8FDB\u800C\u8FBE\u5230\u6B63\u5E38\u8BBF\u95EE\u5916\u90E8\u7F51\u7EDC\u7684\u6548\u679C\u3002</p><div class="language-bash ext-sh"><pre class="language-bash"><code>iptables <span class="token parameter variable">-t</span> nat <span class="token parameter variable">-A</span> POSTROUTING <span class="token parameter variable">-s</span> <span class="token number">192.168</span>.0.0/24 <span class="token operator">!</span> <span class="token parameter variable">-o</span> br0 <span class="token parameter variable">-j</span> MASQUERADE
</code></pre></div><p>\u518Dping\u4E00\u4E0B\u8BD5\u8BD5</p><div class="language-bash ext-sh"><pre class="language-bash"><code>PING <span class="token number">10.153</span>.*.* <span class="token punctuation">(</span><span class="token number">10.153</span>.*.*<span class="token punctuation">)</span> <span class="token number">56</span><span class="token punctuation">(</span><span class="token number">84</span><span class="token punctuation">)</span> bytes of data.
<span class="token number">64</span> bytes from <span class="token number">10.153</span>.*.*: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">1</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">250</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">3.77</span> ms
<span class="token number">64</span> bytes from <span class="token number">10.153</span>.*.*: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">2</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">250</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">3.55</span> ms
</code></pre></div><p>\u53EF\u4EE5\u770B\u5230\uFF0C\u5DF2\u7ECF\u80FD\u6B63\u5E38\u901A\u4FE1\u4E86\u3002</p><h3 id="\u5F00\u653E\u7AEF\u53E3" tabindex="-1"><a class="header-anchor" href="#\u5F00\u653E\u7AEF\u53E3" aria-hidden="true">#</a> \u5F00\u653E\u7AEF\u53E3</h3><p>\u6211\u4EEC\u518D\u8003\u8651\u53E6\u5916\u4E00\u4E2A\u9700\u6C42\uFF0C\u90A3\u5C31\u662F\u628A\u5728\u8FD9\u4E2A\u7F51\u7EDC\u547D\u540D\u7A7A\u95F4\u5185\u7684\u670D\u52A1\u63D0\u4F9B\u7ED9\u5916\u90E8\u7F51\u7EDC\u4F7F\u7528\u3002\u548C\u4E0A\u9762\u7684\u95EE\u9898\u4E00\u6837\uFF0C\u865A\u62DF\u7F51\u7EDC\u73AF\u5883\u4E2D 192.168.0.2\u8FD9\u4E2Aip\u5916\u754C\u662F\u4E0D\u8BA4\u8BC6\u5B83\u7684\u3002\u53EA\u6709\u8FD9\u4E2A\u5BBF\u4E3B\u673A\u77E5\u9053\u5B83\u662F\u8C01\uFF0C\u6240\u4EE5\u6211\u4EEC\u540C\u6837\u8FD8\u9700\u8981NAT\u529F\u80FD\u3002</p><p>\u8FD9\u6B21\u6211\u4EEC\u662F<strong>\u8981\u5B9E\u73B0\u5916\u90E8\u7F51\u7EDC\u8BBF\u95EE\u5185\u90E8\u5730\u5740\uFF0C\u6240\u4EE5\u9700\u8981\u7684\u662FDNAT\u914D\u7F6E</strong>\u3002DNAT\u548CSNAT\u914D\u7F6E\u4E2D\u6709\u4E00\u4E2A\u4E0D\u4E00\u6837\u7684\u5730\u65B9\u5C31\u662F\u9700\u8981\u660E\u786E\u6307\u5B9A\u5BB9\u5668\u4E2D\u7684\u7AEF\u53C8\u5728\u5BBF\u4E3B\u673A\u4E0A\u5BF9\u5E94\u54EA\u4E2A\u3002</p><p>\u901A\u8FC7\u4E0B\u9762\u8FD9\u4E2A\u547D\u4EE4\u6765\u914D\u7F6EDNAT\u89C4\u5219\u3002</p><div class="language-bash ext-sh"><pre class="language-bash"><code>
iptables <span class="token parameter variable">-t</span> nat <span class="token parameter variable">-A</span> PREROUTING <span class="token operator">!</span> <span class="token parameter variable">-i</span> br0 <span class="token parameter variable">-p</span> tcp <span class="token parameter variable">-m</span> tcp <span class="token parameter variable">--dport</span> <span class="token number">8088</span> <span class="token parameter variable">-j</span> DNAT --to-destination <span class="token number">192.168</span>.0.2:80

</code></pre></div><p>\u4EE5\u4E0A\u5C31\u662F\u901A\u8FC7\u521B\u5EFAnetwork namespace\uFF0C\u914D\u7F6Ebridge\u6765\u548C\u5916\u90E8\u901A\u4FE1\u7684\u8FC7\u7A0B\u4E86\u3002</p>`,34);function b(h,m){const a=l("router-link");return c(),o("div",null,[u,n("nav",k,[n("ul",null,[n("li",null,[s(a,{to:"#_1-\u521B\u5EFAnetwork-namespace"},{default:e(()=>[t("1.\u521B\u5EFAnetwork namespace")]),_:1})]),n("li",null,[s(a,{to:"#_2-\u521B\u5EFAveth\u5BF9"},{default:e(()=>[t("2.\u521B\u5EFAveth\u5BF9")]),_:1})]),n("li",null,[s(a,{to:"#_3-\u914D\u7F6Enet1"},{default:e(()=>[t("3.\u914D\u7F6Enet1")]),_:1})]),n("li",null,[s(a,{to:"#_4-\u521B\u5EFAbridge"},{default:e(()=>[t("4.\u521B\u5EFAbridge")]),_:1})]),n("li",null,[s(a,{to:"#_5-\u914D\u7F6Ebridge"},{default:e(()=>[t("5.\u914D\u7F6Ebridge")]),_:1})]),n("li",null,[s(a,{to:"#_6-\u5C1D\u8BD5\u8BF7\u6C42\u5916\u90E8\u8D44\u6E90"},{default:e(()=>[t("6.\u5C1D\u8BD5\u8BF7\u6C42\u5916\u90E8\u8D44\u6E90")]),_:1})]),n("li",null,[s(a,{to:"#_7-\u914D\u7F6E\u8DEF\u7531"},{default:e(()=>[t("7.\u914D\u7F6E\u8DEF\u7531")]),_:1})]),n("li",null,[s(a,{to:"#_8-\u914D\u7F6E\u8F6C\u53D1"},{default:e(()=>[t("8.\u914D\u7F6E\u8F6C\u53D1")]),_:1})]),n("li",null,[s(a,{to:"#_9-\u914D\u7F6Esnat"},{default:e(()=>[t("9.\u914D\u7F6ESNAT")]),_:1})]),n("li",null,[s(a,{to:"#\u5F00\u653E\u7AEF\u53E3"},{default:e(()=>[t("\u5F00\u653E\u7AEF\u53E3")]),_:1})])])]),d])}var v=p(i,[["render",b],["__file","2023-09-09-create-networknamespace copy.html.vue"]]);export{v as default};
